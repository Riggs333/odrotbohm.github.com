
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>Oliver Gierke - Spring, logging and JMX</title>
   <meta name="author" content="Oliver Gierke" />
   <link href="/atom.xml" rel="alternate" title="Blog Atom Feed" type="application/atom+xml" />

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/assets/themes/tom/css/syntax.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/assets/themes/tom/css/screen.css" type="text/css" media="screen, projection" />

   <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:bold|Fira+Sans:light" type="text/css" />

   <!-- Typekit -->
   <script type="text/javascript" src="http://use.typekit.com/jpd0pfm.js"></script>
   <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>
<body>

  <div class="site">
    <div class="title">
      <a href="/">Oliver Gierke</a>

      <a class="extra" href="/archive.html">Archive</a>
      <a class="extra" href="/about.html">About</a>
      <a class="extra" href="/tags.html">Tags</a>
    </div>

    
<div id="post">
  <h1>Spring, logging and JMX</h1>
  <p class="meta">
    01 October 2010 
    
  </p>
  
<p>Pretty much every application out in the wild is using logging to some extend. As applications tend to have bugs (yes, yours as well) it’s a common requirement to alter log levels at runtime. As JMX (Java Management Extensions) is a standard to monitor and manage applications it seems to be a reasonable approach to expose the loggers used in an application via JMX to allow tuning of log levels via a JMX client like jconsole. So let’s take a look on how you enable JMX with Spring.</p>

<pre><code>&lt;context:mbean-server /&gt;
&lt;context:mbean-export /&gt;
</code></pre>

<p>The first element from the context namespace sets up a JMX server so that MBeans can be registered. The second element activates automatic export of all Spring beans the either leverage Spring JMX support (annotation based) or Spring beans that satisfy the JMX naming scheme (a class implementing an interface named <code>${classname}MBean</code>). Fortunately Log4J ships with a <code>LoggerDynamicMBean</code> that exports a <code>Logger</code> instance to the JMX infrastructure. It’s API is not really built with dependency injection in mind but due to the flexibility of the Spring XML configuration language we could register this MBean as follows:</p>

<pre><code>&lt;bean class="org.apache.log4j.jmx.LoggerDynamicMBean"&gt;
  &lt;constructor-arg&gt;
    &lt;bean class="org.apache.log4j.Logger" factory-method="getLogger"&gt;
      &lt;constructor-arg value="org.springframework.jmx" /&gt;
    &lt;/bean&gt;
  &lt;/constructor-arg&gt;
&lt;/bean&gt;
</code></pre>

<p>Running this in combination with the XML snippet above now exposes the logger for org.springframework.jmx as JMX MBean.</p>

<h2 id="xml-hell-go-make-it-clear-and-nice">XML Hell? Go make it clear and nice!</h2>

<p>Declaring the MBean for a single logger requires quite an amount of XML and is boilerplate to a large degree. The two things that are unique in this case is that we want to expose a Log4J logger and the logger name of <code>org.springframework.jmx</code>. So what if we could expose the logger with something like this:</p>

<pre><code>&lt;jmx:logger type="Log4J" name="org.springframework.jmx" /&gt;
</code></pre>

<p>We can! I’ve created a small <a href="http://github.com/olivergierke/spring-jmx-namespace">sample project</a> project containing a custom JMX namespace and put it up on Github. The README file contains instructions how to play around with the Sample class, altering the log level via jconsole and see results in the console output. Right now it’s pretty much just a proof of concept and could be improved in a few corners. We should support other logging libraries and we could transparently register and whcih is not the case currently. Feel free to suggest or add extensions!</p>

</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>09 Oct 2016</span> &raquo; <a href="/2016/10/evolving-distributed-systems/">Evolving Distributed Systems</a></li>
    
      <li><span>29 Apr 2016</span> &raquo; <a href="/2016/04/benefits-of-hypermedia/">The Benefits of Hypermedia APIs</a></li>
    
      <li><span>22 Nov 2013</span> &raquo; <a href="/2013/11/why-field-injection-is-evil/">Why field injection is evil</a></li>
    
  </ul>
</div>




  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'olivergierke'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>






    <div class="footer">
      <div class="contact">
        <p>
          Oliver Gierke<br />
          Soul Power!<br />
        </p>
      </div>
      <div class="contact">
        <p>
          <a href="http://github.com/olivergierke/">github.com/olivergierke</a><br />
          <a href="http://twitter.com/olivergierke/">twitter.com/olivergierke</a><br />
          <a href='mailto:info@olivergierke.de'>info@olivergierke.de</a>
        </p>
      </div>
      <div class="rss">
        <a href="/atom.xml">
          <img src="/assets/themes/tom/images/rss.png" alt="Subscribe to Atom Feed" />
        </a>
      </div>
    </div>
  </div>
  <a href="http://github.com/olivergierke"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>

  
</body>
</html>

