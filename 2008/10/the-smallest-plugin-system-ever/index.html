
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>Oliver Gierke - The smallest plugin system ever</title>
   <meta name="author" content="Oliver Gierke" />
   <link href="/atom.xml" rel="alternate" title="Blog Atom Feed" type="application/atom+xml" />

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/assets/themes/tom/css/syntax.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/assets/themes/tom/css/screen.css" type="text/css" media="screen, projection" />

   <!-- Typekit -->
   <script type="text/javascript" src="http://use.typekit.com/jpd0pfm.js"></script>
   <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>
<body>

  <div class="site">
    <div class="title">
      <a href="/">Oliver Gierke</a>

      <a class="extra" href="/archive.html">Archive</a>
      <a class="extra" href="/about.html">About</a>
      <a class="extra" href="/tags.html">Tags</a>
    </div>
  
    
<div id="post">
  <h1>The smallest plugin system ever</h1>
  <p class="meta">
    09 October 2008 
    
  </p>
  <p>I blogged about <a href='http://www.olivergierke.de/wordpress/2008/09/26/hades-02-is-out/'>Hades</a>, an OpenSource project I lead a while ago. Today I want to launch another neat library. Much smaller than Hades but IMHO useful nevertheless.</p>

<p>Developing Spring applications you often come to the point of having a component that should get a list of collaborateurs injected. The component in turn does select one or many of these collaborateurs based on a defined criteria and works with them. This raises a few requirements:</p>

<ul>
<li>The component should have the easiest possible access to collaborateurs.</li>

<li>Plugins (hey, we got a name for it!) should be addable by just dropping in a JAR file with an implementation of the collaborateurs interface.</li>

<li>I would be nice if we could integrate this with Spring</li>
</ul>

<p>Here&#8217;s the solution I came up withâ€¦</p>

<p>I have an interface <code>Plugin&lt;T&gt;</code>, where T defines the criteria or delimiter to select plugins that shall actually be invoked. The only method this interface contains is <code>boolean supports(T delimiter)</code>. To define an actual plugin interface you create an interface that extends Plugin, declare the delimiter and add the business methods you want the plugin to provide. E.g.:</p>

<pre><code>public interface NotificationProvider implements Plugin&lt;String&gt; {
  void notify(Notification notification);
}</code></pre>

<p>Your <code>NotificationProvider</code> instances have to implement <code>supports</code> thus decide if they are able to handle the given delimiter or not. In most cases the delimiter might be a parameter of some business method like <code>Notification</code> in this case, but it does not have to be.</p>

<p>The next core abstraction is the <code>PluginRegistry&lt;S extends Plugin&lt;T&gt;, T&gt;</code>. Wow, whatta signature. Instantiating it, it allows you to register <code>Plugin</code>s of type <code>S</code> and in turn access the by providing delimiter in various ways. You can ask the registry for the first suitable <code>Plugin</code>, all suitable plugins or ask for mandatory plugins and let the registry throw an exception if none found. See the <a href='http://trac.synyx.org/hera/chrome/site/mvn/plugin-core/apidocs/index.html'>JavaDoc</a> for details.</p>

<p>Thats a lot of lowlevel code but enables you to define clean plugin interfaces and manage access to plugin instances in an elegant way. So you can easily inject a <code>PluginRegistry</code> into a Spring bean and access plugins as you like.</p>

<pre><code>&lt;bean id=&quot;notificationProviders&quot; class=&quot;org.synyx.plugin.core.PluginRegistry&quot;&gt;
  &lt;property name=&quot;plugins&quot;&gt;
    &lt;list&gt;
      &lt;bean class=&quot;com.acme.notification.EmailNotificationProvider&quot; /&gt;
      &lt;bean class=&quot;com.acme.notification.JabberNotificationProvider&quot; /&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre>

<h2 id='how_to_create_a_registry'>How to create a registry?</h2>

<p>Well, thats nice but quite static. What if you would like to allow your colleague to create a JAR file to drop in your classpath and automatically find his <code>NotificationProvider</code> implementation after next application restart.</p>

<p>Note that I do not want to cover exchanging JARs at runtime, rather want to feature some kind of &#8220;configuration on packaging&#8221; with the least overhead possible.</p>

<p>This is where Spring comes into play again. I implemented a <code>PluginRegistryBeanFactoryPostProcessor</code> (only less than half of the class name length is my fault ;). It will rummage the parsed bean definitions and combine those implementing a certain interface in a <code>PluginRegistry</code> and expose it as a new bean in the application context itself.</p>

<pre><code>&lt;bean class=&quot;org.synyx.plugin.support.PluginRegistryBeanFactoryPostProcessor&quot;&gt;
  &lt;property name=&quot;lists&quot;&gt;
    &lt;map&gt;
      &lt;entry key=&quot;notificationProviders&quot;
        value=&quot;com.acme.notification.NotificationProvider&quot; /&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre>

<p>The property name lists is somewhat ugly as it expects a map as parameter. This is because you ca define multiple lists, each entry results in one list or better named <code>PluginRegistry</code>. This is mainly due to the requirement to create multiple <code>PluginRegistry</code>s with one <code>BeanPostProcessor</code>. Maybe we&#8217;d drop this providing a more speaking interface but take into account to register one <code>BeanFactoryPostProcessor</code> for one <code>PluginRegistry</code>.</p>

<h2 id='so_how_do_you_set_up_your_plugin_jars'>So how do you set up your plugin JARs?</h2>

<p>What we can&#8217;t free you from is declaring your plugin implementation as a Spring bean. You should define a special configuration file location and name to allow the plugin host to automatically lookup the plugin configuration file via a wildcarded import, e.g.</p>

<p><code>&lt;import resource=&quot;classpath*:com/acme/**/plugin-context.xml&quot; /&gt;</code></p>

<p>Defining this along with the <code>BeanPostProcessor</code> above in your plugin host JAR will allow you to simply drop plugin JARs into your classpath and let them provide plugin implementation. Using maven you simply need to declare the plugin implementation project as dependency, turning Maven <code>pom.xml</code> files into some kind of program instance configuration.</p>

<h2 id='syntactic_sugar'>Syntactic sugar</h2>

<p>As you might have noticed, registration of the <code>BeanFactoryPostProcessor</code> is somewhat ugly. Besides the enormous name it is a LOT of XML to just define registering all beans implementing <code>Foo</code> under <code>bar</code>. Furthermore the entry&#8217;s &#8220;key&#8221; is actually the bean id the <code>PluginRegistry</code> is registered under, the &#8220;value&#8221; is actually a type name.</p>

<p>To ease configuration a little I&#8217;ve added a Spring namespace implementation , that boils declaring a <code>PluginRegistry</code> down to something like this:</p>

<pre><code>&lt;plugin:registry id=&quot;notificationProviders&quot;
  class=&quot;com.acme.notification.NotificationProvider&quot; /&gt;</code></pre>

<p>You can gain Eclipse classname code completion by adding <code>org/synyx/plugin/core/config/plugin-config.xsd</code> to your XML catalog. If you installed <a href='http://springide.org'>Spring IDE</a>, it should come up with the code completion if you edit the class attribute of the registry element.</p>

<h2 id='simple_lists'>Simple lists</h2>

<p>The project also includes Spring support for a little stripped down version of the requirements by providing a <code>BeanListBeanFactoryPostProcessor</code>, that simply combines bean implementing a given interface to a list. This is useful if you want to leverage the automatic lookup functionality but do not need to select beans based on a given criteria and thus in turn not need to implement <code>Plugin</code> and use <code>PluginRegistry</code>. Of course there is also a namespace element list, that provides a configuration shortcut to define this <code>BeanFactoryPostProcessor</code>, too.</p>

<h2 id='summary'>Summary</h2>

<p>The library offers sophisticated support for the little man&#8217;s need to dynamically add and remove plugins at packaging time and thus helps to modularize applications where a fully fledged plugin environment like OSGi can not be used or would be overkill to use.</p>

<p>The library is available in version 0.1 under Apache License 2.0 and can be downloaded from the project website or directly accessed via our Maven repository. I haven&#8217;t really polished the website nor declared license text in the source files. This is due to change in a few days.</p>

<p>We don&#8217;t have an offical name for the library yet, so any suggestion is welcome. It would be nice, if we could find a name based in greek mythology as we at Synyx typically use names from that scope for software projects.</p>

<p>If you have any comments, ideas, critique dont&#8217;t hesitate to leave a comment or contact me directly.</p>

<h2 id='links'>Links</h2>

<ul>
<li><a href='http://trac.synyx.org/hera'>Project website</a></li>
</ul>

<p>Update: We decided to use Hera as the name for the project as all our projects are named around gods of the greek mythology. This affected the project URL.</p>
</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>16 Dec 2012</span> &raquo; <a href="/2012/12/hello-world">Hello World</a></li>
    
      <li><span>01 Oct 2010</span> &raquo; <a href="/2010/10/spring-logging-and-jmx">Spring, logging and JMX</a></li>
    
      <li><span>15 Sep 2010</span> &raquo; <a href="/2010/09/enabling-hibernate-critera-query-statistics-with-aspectj">Enabling Hibernate criteria query statistics with AspectJ</a></li>
    
  </ul>
</div>




  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'olivergierke'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>





  
    <div class="footer">
      <div class="contact">
        <p>
          Oliver Gierke<br />
          Soul Power!<br />
        </p>
      </div>
      <div class="contact">
        <p>
          <a href="http://github.com/olivergierke/">github.com/olivergierke</a><br />
          <a href="http://twitter.com/olivergierke/">twitter.com/olivergierke</a><br />
          <a href='mailto:info@olivergierke.de'>info@olivergierke.de</a>
        </p>
      </div>
      <div class="rss">
        <a href="/atom.xml">
          <img src="/assets/themes/tom/images/rss.png" alt="Subscribe to Atom Feed" />
        </a>
      </div>
    </div>
  </div>
  <a href="http://github.com/olivergierke"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>

  
</body>
</html>

