
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>Oliver Gierke - JavaC issues implementing generics</title>
   <meta name="author" content="Oliver Gierke" />
   <link href="/atom.xml" rel="alternate" title="Blog Atom Feed" type="application/atom+xml" />

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/assets/themes/tom/css/syntax.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/assets/themes/tom/css/screen.css" type="text/css" media="screen, projection" />

   <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:bold|Fira+Sans:light" type="text/css" />

   <!-- Typekit -->
   <script type="text/javascript" src="http://use.typekit.com/jpd0pfm.js"></script>
   <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>
<body>

  <div class="site">
    <div class="title">
      <a href="/">Oliver Gierke</a>

      <a class="extra" href="/archive.html">Archive</a>
      <a class="extra" href="/about.html">About</a>
      <a class="extra" href="/tags.html">Tags</a>
    </div>

    
<div id="post">
  <h1>JavaC issues implementing generics</h1>
  <p class="meta">
    15 December 2008 
    
  </p>
  <p>Attenting <a href="http://www.olivergierke.de/wordpress/2008/12/devoxx-2008">Devoxx last week</a>, I had the chance to talk to Joshua Bloch about an compiler issue I had a while ago implementing static factory method pattern from his book. Take this as example:</p>

<pre><code>public class PluginRegistry &lt;T extends Plugin&lt;S&gt;, S&gt; {
  public static &lt;T extends Plugin&lt;S&gt;, S&gt;
    PluginRegistry&lt;T, S&gt; create() {
    return new PluginRegistry();
  }
}

PluginRegistry&lt;Plugin&lt;String&gt;, String&gt; registry =
  PluginRegistry.create();
</code></pre>

<p>Don’t try to get the details, there are only three important things:</p>

<ul>
  <li>Two generic parametrizations, where one is a derived one from the other</li>
  <li>The static factory method as suggested to ease using this generic class in Josh Blochs “Effective Java 2” (Item 1)</li>
  <li>The last line takes advantage of this method to create an instance of the registry.</li>
</ul>

<p>The strange thing is, this compiles within Eclipse but does not on plain <code>javac</code>. I mailed Alex Buckley about the issue and after some back and forth he discovered a strange issue with javac.</p>

<p>To let the cat out of the bag: its a bug in javac. Actually according to Maurizio Cimadamore it is a coeffect of some bugs that are actually already marked as fixed (<a href="http://bugs.sun.com/view_bug.do?bug_id=6192945">6192945</a>, <a href="http://bugs.sun.com/view_bug.do?bug_id=6369605">6369605</a>, <a href="http://bugs.sun.com/view_bug.do?bug_id=6193815">6193815</a>). I’ll leave out the bloody details, here is, what it boils down to:</p>

<p><code>Javac</code> somehow only tries to lookup types forward in this case. It infers <code>T == Plugin&lt;String&gt;</code>, but complains that for it <code>Plugin&lt;String&gt;</code> is not a subtype of <code>Plugin&lt;S&gt;</code> (as it has not inferred S yet). Guess what, if you simply switch the generic parameters, it compiles like a charm:</p>

<pre><code>public class PluginRegistry &lt;T extends Plugin&lt;S&gt;, S&gt; {
  public static &lt;S, T extends Plugin&lt;S&gt;&gt;
    PluginRegistry&lt;T, S&gt; create() {
    return new PluginRegistry();
  }
}

PluginRegistry&lt;Plugin&lt;String&gt;, String&gt; registry =
  PluginRegistry.create();
</code></pre>

<p>(Note the order of the generic types in the method signature)</p>

<p>Tell me if it’s just me, but now the method signature somehow looks “wrong” to me. As the types are not being derived in the order they are declared at the method. Nevertheless, I at least compiles both on <code>javac</code> and the Eclipse compiler. So keep an eye on stuff like this, if you implement generic types ;). I’ll give you an update if there are further things happen on this.</p>

</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>29 Apr 2016</span> &raquo; <a href="/2016/04/benefits-of-hypermedia/index.html">The Benefits of Hypermedia APIs</a></li>
    
      <li><span>22 Nov 2013</span> &raquo; <a href="/2013/11/why-field-injection-is-evil/index.html">Why field injection is evil</a></li>
    
      <li><span>20 Sep 2013</span> &raquo; <a href="/2013/09/666-hell-not-found/index.html">666 - Hell not found</a></li>
    
  </ul>
</div>




  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'olivergierke'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>






    <div class="footer">
      <div class="contact">
        <p>
          Oliver Gierke<br />
          Soul Power!<br />
        </p>
      </div>
      <div class="contact">
        <p>
          <a href="http://github.com/olivergierke/">github.com/olivergierke</a><br />
          <a href="http://twitter.com/olivergierke/">twitter.com/olivergierke</a><br />
          <a href='mailto:info@olivergierke.de'>info@olivergierke.de</a>
        </p>
      </div>
      <div class="rss">
        <a href="/atom.xml">
          <img src="/assets/themes/tom/images/rss.png" alt="Subscribe to Atom Feed" />
        </a>
      </div>
    </div>
  </div>
  <a href="http://github.com/olivergierke"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>

  
</body>
</html>

